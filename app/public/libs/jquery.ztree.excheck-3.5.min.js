/*
 * JQuery zTree excheck v3.5.19.2
 * http://zTree.me/
 *
 * Copyright (c) 2010 Hunter.z
 *
 * Licensed same as jquery - MIT License
 * http://www.opensource.org/licenses/mit-license.php
 *
 * email: hunter.z@263.net
 * Date: 2015-11-15
 */

(function(e){var t,n,r,i={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},s={check:{enable:!1,autoCheckTrigger:!1,chkStyle:i.checkbox.STYLE,nocheckInherit:!1,chkDisabledInherit:!1,radioType:i.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}};t=function(e,t){if(t.chkDisabled===!0)return!1;var n=f.getSetting(e.data.treeId),r=n.data.key.checked;return o.apply(n.callback.beforeCheck,[n.treeId,t],!0)==0?!0:(t[r]=!t[r],a.checkNodeRelation(n,t),r=l(t,u.id.CHECK,n),a.setChkClass(n,r,t),a.repairParentChkClassWithSelf(n,t),n.treeObj.trigger(u.event.CHECK,[e,n.treeId,t]),!0)},n=function(e,t){if(t.chkDisabled===!0)return!1;var n=f.getSetting(e.data.treeId),r=l(t,u.id.CHECK,n);return t.check_Focus=!0,a.setChkClass(n,r,t),!0},r=function(e,t){if(t.chkDisabled===!0)return!1;var n=f.getSetting(e.data.treeId),r=l(t,u.id.CHECK,n);return t.check_Focus=!1,a.setChkClass(n,r,t),!0},e.extend(!0,e.fn.zTree.consts,i),e.extend(!0,e.fn.zTree._z,{tools:{},view:{checkNodeRelation:function(e,t){var n,r,i,s=e.data.key.children,o=e.data.key.checked;n=u.radio;if(e.check.chkStyle==n.STYLE){var c=f.getRadioCheckedList(e);if(t[o])if(e.check.radioType==n.TYPE_ALL){for(r=c.length-1;r>=0;r--)n=c[r],n[o]&&n!=t&&(n[o]=!1,c.splice(r,1),a.setChkClass(e,l(n,u.id.CHECK,e),n),n.parentTId!=t.parentTId&&a.repairParentChkClassWithSelf(e,n));c.push(t)}else{c=t.parentTId?t.getParentNode():f.getRoot(e);for(r=0,i=c[s].length;r<i;r++)n=c[s][r],n[o]&&n!=t&&(n[o]=!1,a.setChkClass(e,l(n,u.id.CHECK,e),n))}else if(e.check.radioType==n.TYPE_ALL)for(r=0,i=c.length;r<i;r++)if(t==c[r]){c.splice(r,1);break}}else t[o]&&(!t[s]||t[s].length==0||e.check.chkboxType.Y.indexOf("s")>-1)&&a.setSonNodeCheckBox(e,t,!0),!t[o]&&(!t[s]||t[s].length==0||e.check.chkboxType.N.indexOf("s")>-1)&&a.setSonNodeCheckBox(e,t,!1),t[o]&&e.check.chkboxType.Y.indexOf("p")>-1&&a.setParentNodeCheckBox(e,t,!0),!t[o]&&e.check.chkboxType.N.indexOf("p")>-1&&a.setParentNodeCheckBox(e,t,!1)},makeChkClass:function(e,t){var n=e.data.key.checked,r=u.checkbox,i=u.radio,s="",s=t.chkDisabled===!0?r.DISABLED:t.halfCheck?r.PART:e.check.chkStyle==i.STYLE?t.check_Child_State<1?r.FULL:r.PART:t[n]?t.check_Child_State===2||t.check_Child_State===-1?r.FULL:r.PART:t.check_Child_State<1?r.FULL:r.PART,n=e.check.chkStyle+"_"+(t[n]?r.TRUE:r.FALSE)+"_"+s,n=t.check_Focus&&t.chkDisabled!==!0?n+"_"+r.FOCUS:n;return u.className.BUTTON+" "+r.DEFAULT+" "+n},repairAllChk:function(e,t){if(e.check.enable&&e.check.chkStyle===u.checkbox.STYLE)for(var n=e.data.key.checked,r=e.data.key.children,i=f.getRoot(e),s=0,o=i[r].length;s<o;s++){var l=i[r][s];l.nocheck!==!0&&l.chkDisabled!==!0&&(l[n]=t),a.setSonNodeCheckBox(e,l,t)}},repairChkClass:function(e,t){if(t&&(f.makeChkFlag(e,t),t.nocheck!==!0)){var n=l(t,u.id.CHECK,e);a.setChkClass(e,n,t)}},repairParentChkClass:function(e,t){if(t&&t.parentTId){var n=t.getParentNode();a.repairChkClass(e,n),a.repairParentChkClass(e,n)}},repairParentChkClassWithSelf:function(e,t){if(t){var n=e.data.key.children;t[n]&&t[n].length>0?a.repairParentChkClass(e,t[n][0]):a.repairParentChkClass(e,t)}},repairSonChkDisabled:function(e,t,n,r){if(t){var i=e.data.key.children;t.chkDisabled!=n&&(t.chkDisabled=n),a.repairChkClass(e,t);if(t[i]&&r)for(var s=0,o=t[i].length;s<o;s++)a.repairSonChkDisabled(e,t[i][s],n,r)}},repairParentChkDisabled:function(e,t,n,r){t&&(t.chkDisabled!=n&&r&&(t.chkDisabled=n),a.repairChkClass(e,t),a.repairParentChkDisabled(e,t.getParentNode(),n,r))},setChkClass:function(e,t,n){t&&(n.nocheck===!0?t.hide():t.show(),t.attr("class",a.makeChkClass(e,n)))},setParentNodeCheckBox:function(e,t,n,r){var i=e.data.key.children,s=e.data.key.checked,o=l(t,u.id.CHECK,e);r||(r=t),f.makeChkFlag(e,t),t.nocheck!==!0&&t.chkDisabled!==!0&&(t[s]=n,a.setChkClass(e,o,t),e.check.autoCheckTrigger&&t!=r&&e.treeObj.trigger(u.event.CHECK,[null,e.treeId,t]));if(t.parentTId){o=!0;if(!n)for(var i=t.getParentNode()[i],c=0,h=i.length;c<h;c++)if(i[c].nocheck!==!0&&i[c].chkDisabled!==!0&&i[c][s]||(i[c].nocheck===!0||i[c].chkDisabled===!0)&&i[c].check_Child_State>0){o=!1;break}o&&a.setParentNodeCheckBox(e,t.getParentNode(),n,r)}},setSonNodeCheckBox:function(e,t,n,r){if(t){var i=e.data.key.children,s=e.data.key.checked,o=l(t,u.id.CHECK,e);r||(r=t);var c=!1;if(t[i])for(var h=0,p=t[i].length;h<p&&t.chkDisabled!==!0;h++){var d=t[i][h];a.setSonNodeCheckBox(e,d,n,r),d.chkDisabled===!0&&(c=!0)}if(t!=f.getRoot(e)&&t.chkDisabled!==!0){c&&t.nocheck!==!0&&f.makeChkFlag(e,t);if(t.nocheck!==!0&&t.chkDisabled!==!0){if(t[s]=n,!c)t.check_Child_State=t[i]&&t[i].length>0?n?2:0:-1}else t.check_Child_State=-1;a.setChkClass(e,o,t),e.check.autoCheckTrigger&&t!=r&&t.nocheck!==!0&&t.chkDisabled!==!0&&e.treeObj.trigger(u.event.CHECK,[null,e.treeId,t])}}}},event:{},data:{getRadioCheckedList:function(e){for(var t=f.getRoot(e).radioCheckedList,n=0,r=t.length;n<r;n++)f.getNodeCache(e,t[n].tId)||(t.splice(n,1),n--,r--);return t},getCheckStatus:function(e,t){if(!e.check.enable||t.nocheck||t.chkDisabled)return null;var n=e.data.key.checked;return{checked:t[n],half:t.halfCheck?t.halfCheck:e.check.chkStyle==u.radio.STYLE?t.check_Child_State===2:t[n]?t.check_Child_State>-1&&t.check_Child_State<2:t.check_Child_State>0}},getTreeCheckedNodes:function(e,t,n,r){if(!t)return[];for(var i=e.data.key.children,s=e.data.key.checked,o=n&&e.check.chkStyle==u.radio.STYLE&&e.check.radioType==u.radio.TYPE_ALL,r=r?r:[],a=0,l=t.length;a<l;a++){if(t[a].nocheck!==!0&&t[a].chkDisabled!==!0&&t[a][s]==n&&(r.push(t[a]),o))break;f.getTreeCheckedNodes(e,t[a][i],n,r);if(o&&r.length>0)break}return r},getTreeChangeCheckedNodes:function(e,t,n){if(!t)return[];for(var r=e.data.key.children,i=e.data.key.checked,n=n?n:[],s=0,o=t.length;s<o;s++)t[s].nocheck!==!0&&t[s].chkDisabled!==!0&&t[s][i]!=t[s].checkedOld&&n.push(t[s]),f.getTreeChangeCheckedNodes(e,t[s][r],n);return n},makeChkFlag:function(e,t){if(t){var n=e.data.key.children,r=e.data.key.checked,i=-1;if(t[n])for(var s=0,o=t[n].length;s<o;s++){var a=t[n][s],f=-1;if(e.check.chkStyle==u.radio.STYLE){if(f=a.nocheck===!0||a.chkDisabled===!0?a.check_Child_State:a.halfCheck===!0?2:a[r]?2:a.check_Child_State>0?2:0,f==2){i=2;break}f==0&&(i=0)}else if(e.check.chkStyle==u.checkbox.STYLE){if(f=a.nocheck===!0||a.chkDisabled===!0?a.check_Child_State:a.halfCheck===!0?1:a[r]?a.check_Child_State===-1||a.check_Child_State===2?2:1:a.check_Child_State>0?1:0,f===1){i=1;break}if(f===2&&i>-1&&s>0&&f!==i){i=1;break}if(i===2&&f>-1&&f<2){i=1;break}f>-1&&(i=f)}}t.check_Child_State=i}}}});var e=e.fn.zTree,o=e._z.tools,u=e.consts,a=e._z.view,f=e._z.data,l=o.$;f.exSetting(s),f.addInitBind(function(e){e.treeObj.bind(u.event.CHECK,function(t,n,r,i){t.srcEvent=n,o.apply(e.callback.onCheck,[t,r,i])})}),f.addInitUnBind(function(e){e.treeObj.unbind(u.event.CHECK)}),f.addInitCache(function(){}),f.addInitNode(function(e,t,n,r){n&&(t=e.data.key.checked,typeof n[t]=="string"&&(n[t]=o.eqs(n[t],"true")),n[t]=!!n[t],n.checkedOld=n[t],typeof n.nocheck=="string"&&(n.nocheck=o.eqs(n.nocheck,"true")),n.nocheck=!!n.nocheck||e.check.nocheckInherit&&r&&!!r.nocheck,typeof n.chkDisabled=="string"&&(n.chkDisabled=o.eqs(n.chkDisabled,"true")),n.chkDisabled=!!n.chkDisabled||e.check.chkDisabledInherit&&r&&!!r.chkDisabled,typeof n.halfCheck=="string"&&(n.halfCheck=o.eqs(n.halfCheck,"true")),n.halfCheck=!!n.halfCheck,n.check_Child_State=-1,n.check_Focus=!1,n.getCheckStatus=function(){return f.getCheckStatus(e,n)},e.check.chkStyle==u.radio.STYLE&&e.check.radioType==u.radio.TYPE_ALL&&n[t]&&f.getRoot(e).radioCheckedList.push(n))}),f.addInitProxy(function(e){var i=e.target,s=f.getSetting(e.data.treeId),a="",l=null,c="",h=null;o.eqs(e.type,"mouseover")?s.check.enable&&o.eqs(i.tagName,"span")&&i.getAttribute("treeNode"+u.id.CHECK)!==null&&(a=o.getNodeMainDom(i).id,c="mouseoverCheck"):o.eqs(e.type,"mouseout")?s.check.enable&&o.eqs(i.tagName,"span")&&i.getAttribute("treeNode"+u.id.CHECK)!==null&&(a=o.getNodeMainDom(i).id,c="mouseoutCheck"):o.eqs(e.type,"click")&&s.check.enable&&o.eqs(i.tagName,"span")&&i.getAttribute("treeNode"+u.id.CHECK)!==null&&(a=o.getNodeMainDom(i).id,c="checkNode");if(a.length>0)switch(l=f.getNodeCache(s,a),c){case"checkNode":h=t;break;case"mouseoverCheck":h=n;break;case"mouseoutCheck":h=r}return{stop:c==="checkNode",node:l,nodeEventType:c,nodeEventCallback:h,treeEventType:"",treeEventCallback:null}},!0),f.addInitRoot(function(e){f.getRoot(e).radioCheckedList=[]}),f.addBeforeA(function(e,t,n){e.check.enable&&(f.makeChkFlag(e,t),n.push("<span ID='",t.tId,u.id.CHECK,"' class='",a.makeChkClass(e,t),"' treeNode",u.id.CHECK,t.nocheck===!0?" style='display:none;'":"","></span>"))}),f.addZTreeTools(function(e,t){t.checkNode=function(e,t,n,r){var i=this.setting.data.key.checked;e.chkDisabled!==!0&&(t!==!0&&t!==!1&&(t=!e[i]),r=!!r,(e[i]!==t||n)&&(!r||o.apply(this.setting.callback.beforeCheck,[this.setting.treeId,e],!0)!=0)&&o.uCanDo(this.setting)&&this.setting.check.enable&&e.nocheck!==!0)&&(e[i]=t,t=l(e,u.id.CHECK,this.setting),(n||this.setting.check.chkStyle===u.radio.STYLE)&&a.checkNodeRelation(this.setting,e),a.setChkClass(this.setting,t,e),a.repairParentChkClassWithSelf(this.setting,e),r&&this.setting.treeObj.trigger(u.event.CHECK,[null,this.setting.treeId,e]))},t.checkAllNodes=function(e){a.repairAllChk(this.setting,!!e)},t.getCheckedNodes=function(e){var t=this.setting.data.key.children;return f.getTreeCheckedNodes(this.setting,f.getRoot(this.setting)[t],e!==!1)},t.getChangeCheckedNodes=function(){var e=this.setting.data.key.children;return f.getTreeChangeCheckedNodes(this.setting,f.getRoot(this.setting)[e])},t.setChkDisabled=function(e,t,n,r){t=!!t,n=!!n,a.repairSonChkDisabled(this.setting,e,t,!!r),a.repairParentChkDisabled(this.setting,e.getParentNode(),t,n)};var n=t.updateNode;t.updateNode=function(e,r){n&&n.apply(t,arguments);if(e&&this.setting.check.enable&&l(e,this.setting).get(0)&&o.uCanDo(this.setting)){var i=l(e,u.id.CHECK,this.setting);(r==1||this.setting.check.chkStyle===u.radio.STYLE)&&a.checkNodeRelation(this.setting,e),a.setChkClass(this.setting,i,e),a.repairParentChkClassWithSelf(this.setting,e)}}});var c=a.createNodes;a.createNodes=function(e,t,n,r,i){c&&c.apply(a,arguments),n&&a.repairParentChkClassWithSelf(e,r)};var h=a.removeNode;a.removeNode=function(e,t){var n=t.getParentNode();h&&h.apply(a,arguments),t&&n&&(a.repairChkClass(e,n),a.repairParentChkClass(e,n))};var p=a.appendNodes;a.appendNodes=function(e,t,n,r,i,s,o){var u="";return p&&(u=p.apply(a,arguments)),r&&f.makeChkFlag(e,r),u}})(jQuery);