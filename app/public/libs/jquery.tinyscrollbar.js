(function(e){typeof define=="function"&&define.amd?define(["jquery"],e):typeof exports=="object"?module.exports=e(require("jquery")):e(jQuery)})(function(e){function r(r,i){function p(){return e.each(s.bars,function(e,t){s.update(!1,t),v(t)}),s}function d(e){e.$thumb.css(e.posiLabel,e.thumbPosition),u.css(e.posiLabel,-e.contentPosition),e.$scrollbar.css(e.sizeLabel,e.trackSize),e.$track.css(e.sizeLabel,e.trackSize),e.$thumb.css(e.sizeLabel,e.thumbSize)}function v(t){a?o[0].ontouchstart=function(e){1===e.touches.length&&(e.stopPropagation(),y(e.touches[0]))}:(t.$thumb.bind("mousedown",function(e){e.stopPropagation(),y(e)}),t.$track.bind("mousedown",function(e){y(e,!0)})),e(window).resize(function(){s.update("relative")}),s.options.wheel&&window.addEventListener?r[0].addEventListener(f,w,!1):s.options.wheel&&(r[0].onmousewheel=w)}function m(e){return e.contentPosition>0}function g(e){return e.contentPosition<=e.contentSize-e.viewportSize-5}function y(t,n,r){typeof r=="undefined"?e.each(s.bars,function(e,r){b(t,n,r)}):b(t,n,r)}function b(t,n,r){typeof r=="undefined"&&e.each(s.bars,function(n,i){i.$thumb==e(t.target)&&(r=i)}),r&&r.hasContentToSroll&&(e("body").addClass("noSelect"),c=n?r.$thumb.offset()[r.posiLabel]:r.type=="x"?t.pageX:t.pageY,r.hasTouchEvents?(document.ontouchmove=function(e){(s.options.touchLock||m(r)&&g(r))&&e.preventDefault(),E(e.touches[0],r)},document.ontouchend=x):(e(document).bind("mousemove",E),e(document).bind("mouseup",function(){x(r)}),r.$thumb.bind("mouseup",function(){x(r)}),r.$track.bind("mouseup",function(){x(r)})),E(t,r))}function w(t){if(s.hasContentToSroll){var n=t||window.event,i=-(n.deltaY||n.detail||-1/3*n.wheelDelta)/40,u=n.deltaMode===1?s.options.wheelSpeed:1;s.contentPosition-=i*u*s.options.wheelSpeed,s.contentPosition=Math.min(s.contentSize-s.viewportSize,Math.max(0,s.contentPosition)),s.thumbPosition=s.contentPosition/s.trackRatio,r.trigger("move"),$thumb.css(posiLabel,s.thumbPosition),o["scroll"+posiLabel.replace(/^([a-zA-z])/,function(e,t){return t.toUpperCase()})](s.contentPosition);if(s.options.wheelLock||m()&&g())n=e.event.fix(n),n.preventDefault()}t.stopPropagation()}function E(t,n){typeof n=="undefined"?e.each(s.bars,function(e,n){S(t,n)}):S(t,n)}function S(e){if(e.hasContentToSroll){var t=e.type=="x"?event.pageX:event.pageY,n=e.hasTouchEvents?c-t:t-c,i=Math.min(e.trackSize-e.thumbSize,Math.max(0,e.thumbPosition+n));e.contentPosition=i*e.trackRatio,r.trigger("move"),e.$thumb.css(e.posiLabel,i),o["scroll"+e.posiLabel.replace(/^([a-zA-z])/,function(e,t){return t.toUpperCase()})](e.contentPosition)}}function x(t){t.thumbPosition=parseInt(t.$thumb.css(t.posiLabel),10)||0,e("body").removeClass("noSelect"),e(document).unbind("mousemove",function(e){E(e,t)}),e(document).unbind("mouseup",function(){x(t)}),t.$thumb.unbind("mouseup",function(){x(t)}),t.$track.unbind("mouseup",function(){x(t)}),document.ontouchmove=document.ontouchend=null}this.options=e.extend({},n,i),this._defaults=n,this._name=t;var s=this,o=i.$viewPort||r.find(".viewport"),u=i.$overView||r.find(".overview"),a="ontouchstart"in document.documentElement,f="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll",l=this.options.axis==="x",c=0;this.bars=[];var h={contentPosition:0,viewportSize:0,contentSize:0,contentRatio:0,trackSize:0,trackRatio:0,thumbSize:0,thumbPosition:0,hasContentToSroll:!1};return i.$xBarEl&&this.bars.push(e.extend(!0,{},h,{type:"x",$scrollbar:i.$xBarEl,$track:i.$xBarEl.find(".track"),$thumb:i.$xBarEl.find(".thumb"),sizeLabel:"width",contentPosition:0,posiLabel:"left"})),i.$yBarEl&&this.bars.push(e.extend(!0,{},h,{type:"y",$scrollbar:i.$yBarEl,$track:i.$yBarEl.find(".track"),$thumb:i.$yBarEl.find(".thumb"),sizeLabel:"height",posiLabel:"top"})),this.update=function(t,n){return n?s.updateSingle(t,n):e.each(s.bars,function(e,n){s.updateSingle(t,n)}),s},this.updateSingle=function(e,t){var n=t.sizeLabel.charAt(0).toUpperCase()+t.sizeLabel.slice(1).toLowerCase();t.viewportSize=o[0]["offset"+n],t.contentSize=u[0]["scroll"+n],t.contentRatio=t.viewportSize/t.contentSize,t.trackSize=this.options.trackSize||t.viewportSize,t.thumbSize=Math.min(t.trackSize,Math.max(this.options.thumbSizeMin,this.options.thumbSize||t.trackSize*t.contentRatio)),t.trackRatio=(t.contentSize-t.viewportSize)/(t.trackSize-t.thumbSize),t.hasContentToSroll=t.contentRatio<1,t.$scrollbar.toggleClass("disable",!t.hasContentToSroll);switch(e){case"bottom":t.contentPosition=Math.max(t.contentSize-t.viewportSize,0);break;case"relative":t.contentPosition=Math.min(Math.max(t.contentSize-t.viewportSize,0),Math.max(0,t.contentPosition));break;default:t.contentPosition=parseInt(e,10)||0}return t.thumbPosition=t.contentPosition/t.trackRatio,d(t),s},p()}var t="tinyscrollbar",n={axis:"y",wheel:!0,wheelSpeed:40,wheelLock:!0,touchLock:!0,trackSize:!1,thumbSize:!1,thumbSizeMin:20};e.fn[t]=function(n){return this.each(function(){e.data(this,"plugin_"+t)||e.data(this,"plugin_"+t,new r(e(this),n))})}});